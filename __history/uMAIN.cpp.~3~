//---------------------------------------------------------------------------

#include <vcl.h>
#pragma hdrstop
using namespace std;

#include "uMAIN.h"
#include <filesystem>
#include <fstream>

//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.dfm"
TForm1 *Form1;
string File;
string Path;

void unzipDOCX(string file) {
	system(("cd " + Path + " && mkdir temp && cd temp && tar -xf " + File).c_str());
}

string Cesar(string s) {
	for (int i = 0; i < s.length(); i++) {
		s[i] += 1;
	}
    return s;
}

void Crypt() {
	error_code ec;
	for (const auto& dir : filesystem::recursive_directory_iterator(Path)) {
		if (filesystem::is_directory(dir, ec)) {

		}
		if (filesystem::is_regular_file(dir, ec)) {
			filesystem::path file = dir;
			if (file.extension() != ".png") {
				fstream f(dir, ios::in | ios::out);
				while (!f.eof()) {
					string temp;
					getline(f, temp);
					f << Cesar(temp);
				}
				f.close();
			}
		}
    }
}

//---------------------------------------------------------------------------
__fastcall TForm1::TForm1(TComponent* Owner)
	: TForm(Owner)
{
}
//---------------------------------------------------------------------------
void __fastcall TForm1::ÂûáðàòüClick(TObject *Sender)
{
	if (OpenDialogDOCX->Execute()) {
		PATH->Text = OpenDialogDOCX->FileName;
	}
}
//---------------------------------------------------------------------------
void __fastcall TForm1::UNZIPClick(TObject *Sender)
{
	File = AnsiString(PATH->Text).c_str();
	Path = filesystem::path(File).parent_path().u8string();
	unzipDOCX(File);
	Path = Path + "\\temp";
	Crypt();
}
//---------------------------------------------------------------------------
